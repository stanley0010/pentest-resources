# Methodologies

## Attack Surface Mapping

1. Look at:
   1. embedded device
   2. firmware, software and applications
   3. radio communications

## Hardware

### Inspection

* External inspection
* Internal inspection
  * Datasheet, FCC database
  * components used in the device, CPU architecture type, communication protocols used, mobile application details, firmware upgrade process, input/output/debug ports, external media support on devices, etc

### Protocols

* UART
  * Identity pins
  * Connect to Attify Badge (our UART reader device)
  * Identify Baud rate
  * Interact
* I2C, SPI for reading flash/ other storage medium
* JTAG for debugging and dumping contents in flash
* &#x20;![Pasted image 20220707135441.png](<../attachments/Pasted image 20220707135441.png>)

### Methods

* directly connect to debug ports may provide shell
* dumping data
* Shorting NAND pin to gain u-boot root shell, bypassing system shell

## Firmware

* See https://scriptingxss.gitbook.io/firmware-security-testing-methodology/
* be aware of file system and compression method
* getting binary
  * download, dumping, sniffing
    * Check encrypted?
    * If yes, check if XOR encrypted with hexdump
    * if no, extract file system type and contents
* analyzing file system contents and look for:
  * Hard-coded credentials.
  * Backdoor access.
  * Sensitive URLs.
  * Access tokens.
  * API and encryption keys.
  * Encryption algorithms.
  * Local pathnames.
  * Environment details.
  * Authentication and authorization mechanisms.
* binary exploitation
  * firmware diffing with kdiff to find vuln
  * code execution, backdooring
* auto scanner: bytesweep, fuzzing with AFL++

## Mobile, Web and Network Services

* Methods:
  1. RE with MobSF
  2. nmap to look at services open
* Tools:
  1. jadx/ APKTool
  2. radare2/IDA Pro
* Look for:
  1. Hard-coded credentials or sensitive URL
  2. AES Key to decrypt traffic

## Wireless

### Radio

1. identify frequency, modulation, data rate, sample rate
2. decode, replay with different values in the command

### Zigbee and BLE

1. identify channel used among 16 channels
2. intercept, replay, modify packets
3. Tool: KillerBee (not well supported), ZigDiddity, BTLEJuice (framework)

Study packet and observe pattern

&#x20;![Pasted image 20220707110841.png](<../attachments/Pasted image 20220707110841.png>)

## References:

1. The IoT Hacker's Handbook: www.ime.cas.cn/icac/learning/learning\_3/201907/P020190724586712846107.pdf
2. Firmware Pentesting Methodologies: https://scriptingxss.gitbook.io/firmware-security-testing-methodology/
3. Resources for IoT Security: https://github.com/V33RU/IoTSecurity101
4. Hardware List: https://defcon-nn.ru/0x0B/Hardware%20toolkits%20for%20IoT%20security%20analysis.pdf
5. MQTT Security: https://payatu.com/blog/aseem/iot-security---part-10-introduction-to-mqtt-protocol-and-security
