# IoT Pentesting Goals and Attack Vectors

### Goals

1. credentials, hard-coded keys and sensitive info
2. sending unauthenticated request
3. decrypting network traffic to eavesdrop
4. sabotage/ undermine service availability
5. root access to shell

### Hardware

#### Inspection

* External inspection
* Internal inspection
  * Datasheet, FCC database
  * components used in the device, CPU architecture type, communication protocols used, mobile application details, firmware upgrade process, input/output/debug ports, external media support on devices, etc

#### Protocols

![](<../attachments/Pasted image 20220707135441.png>)

* UART
  * Identity pins
  * Connect to Attify Badge (our UART reader device)
  * Identify Baud rate
  * Interact
* I2C, SPI for reading flash/ other storage medium
* JTAG for debugging and dumping contents in flash

#### Approaches

* Informational
  * getting debug info by just connecting
  * dumping data, flash memory and firmware
  * editing data/memory
* System
  * directly connect to debug ports may provide shell
  * Shorting NAND pin to gain u-boot root shell, bypassing system shell
  * replace with malicious firmware

### Firmware

* [OWASP Firmware Pentesting Guide](https://scriptingxss.gitbook.io/firmware-security-testing-methodology/)
* be aware of file system and compression method

#### Getting Binary

* download, dumping, sniffing
  * Check encrypted?
  * If yes, check if XOR encrypted with hexdump
  * if no, extract file system type and contents

#### Analyzing

* firmware diffing with kdiff to find vuln
* Look for
  * Backdoor access.
  * Sensitive URLs.
  * Access tokens.
  * API and encryption keys.
  * Encryption algorithms.
  * Local pathnames.
  * Environment details.
  * Authentication and authorization mechanisms.

Auto scanner: bytesweep, fuzzing with AFL++

### Mobile, Web and Network Services

#### Look For

1. Hard-coded credentials or sensitive URL
2. AES Key to decrypt traffic

#### Methods

1. RE with MobSF
2. nmap to look at services open

#### Tools

1. jadx/ APKTool
2. radare2/IDA Pro

### Communication

#### General Approach

1. identify protocol, frequency/sample rate/modulation, channel and address
2. sniffing and decode
3. (bypass auth)
4. replay-based attack/ modifying packet data

#### MQTT

1. authentication optional and in clear text
2. check if there is sensitive information, subscribe/send to all topics, clientID misconfig
3. fuzzing

#### CoAP

1. check auth mechanism, DTLS may not be used
2. fuzzing URIs
   1. Enumerate resources by GET, check PUT/POST/DELETE

#### Radio

1. identify frequency, modulation, data rate, sample rate
2. decode, replay with different values in the command

#### Zigbee and BLE

1. identify channel used among 16 channels
2. intercept, replay, modify packets
3. Tool: KillerBee (not well supported), ZigDiddity, BTLEJuice (framework)

Study packet and observe pattern

![](<../attachments/Pasted image 20220707110841.png>)
